{% extends "base.html" %}
{% load static %}

{% block content %}


<div class="topbar">
    <a class="btn btn-primary" href="#" onclick="DOM_toggle('.sidebar');">Menu</a>
    <a class="btn btn-primary"  href="/">Home</a>

    
            {% if page_obj.has_previous %}
                <a class="btn btn-primary" href="/items?page={{ page_obj.previous_page_number }}&{{url_state}}">&laquo</a>
            {% else %}
                <!-- <li class="btn btn-primary disabled"><span>&laquo;</span></li>  -->
                <span class="btn btn-primary disabled">&laquo;</span>
            {% endif %}

            {% if page_obj.has_next %}
               <a class="btn btn-primary" href="/items?page={{ page_obj.next_page_number }}&{{url_state}}">&raquo</a>
            {% else %}
                <span class="btn btn-primary disabled">&raquo;</span>
                <!-- <li class="btn btn-primary disabled"><span>&raquo;</span></li>  -->
            {% endif %}            
</div>

<div class="sidebar">

    <ul class="sidebar-nav">
       <li>User: {{ request.user.username }}</li>

       <li>
          <a href="#">log out</a>
      </li>

        <li><a href='/items/new'>Add item</a> </li>

        <li><a href="/items">Last bookmarks</a></li>
        <li><a href="/items?filter=oldest">First bookmarks</a></li>
        <li><a href="/items?filter=starred">Starred Bookmarks</a></li>
        <li><a href="/items?filter=removed">Removed Bookmarks</a></li>
        
        <li><span>Documents Filters</span></li>
        <li> <a href='/items?filter=doctype&A0=book'>Books or online books</a> </li>    
        <li> <a href='/items?filter=doctype&A0=paper'>Papers</a> </li>        
        <li> <a href='/items?filter=doctype&A0=thesis'>Thesis</a> </li>    
        <li> <a href='/items?filter=doctype&A0=reference%20card'>Reference card, cheat sheet</a> </li>       

        <li><span>Media Filters</span></li>
        <li> <a href='/items?filter=doctype&A0=music'>Music</a> </li>
        <li> <a href='/items?filter=doctype&A0=video'>Video</a> </li>
        <li> <a href='/items?filter=doctype&A0=youtube%20channel'>Youtube Channel</a> </li>                        
    </ul>
</div>  

<div id="bookmark-list" class="container">           

    <div id="top-panel">
        <h1>Bookmarks Storage</h1>

        <div class="div-form-search">
          <form method='GET' action="/items" class="form-group">
            <input type="hidden" name="filter" value="search" /> 
            <input type='text' name='query' value='{{ request.GET.query }}'>
            <input class="btn btn-info" type='submit' value="Search">

            <!-- Set search mode  -->
            <select name="mode" title="Select search mode.">
                <option value="AND">AND</option>
                <option value="OR">OR</option>
              </select>        
          </form> 
        </div>
    </div>

    Found {{count}} results / Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.          

    {% for bookmark in object_list %}
        <div class = "well item item_div">   

            <h5>                        
                  <a target='_blank' 
                      title="{{bookmark.brief}}" 
                      href="{{ bookmark.url }}"> 
                      <svg class = "box1" xmlns="http://www.w3.org/2000/svg" 
                          width="1.2rem" height="1.2rem" background="blue" viewBox="0 0 16 16" 
                          focusable="false" aria-hidden="true">
                          <path class="stroke-linecap-square" d="M10 2h4v4">
                          </path><path d="M6 10l8-8"></path>
                          <path class="stroke-linejoin-round" d="M14 9.048V14H2V2h5">
                          </path>
                      </svg>

                        {{ bookmark.modified_title | default:bookmark.url }}                                                
                        
                  </a>
            </h5>
            
            <br/>

                    <a class="btn btn-primary" 
                      title="Edit current item" href="{% url 'bookmarks:bookmark_edit' bookmark.id %}?url={{  request.get_full_path | urlencode }}">Edit</a>
                    
                    {% if bookmark.deleted != True  %}
                        <a class="btn btn-primary" title="Delete current item" href="{% url 'bookmarks:bookmark_delete' bookmark.id %}">Delete</a>                           
                    {% endif %}

                    <a class="btn btn-primary" title="Fetch bookmark metdata automatically" 
                        href="/items/extract_metadata?id={{ bookmark.id }}&url={{ request.get_full_path | urlencode }}">Get metadata</a>

                  {% if bookmark.snapshot_exists %}
                       <a class="btn btn-primary" target="_blank" title="Open file snapshot file" href="/snapshot/file/{{ bookmark.snapshot_file }}">Open snapshot</a>                           
                  {% else %}
                       <a class="btn btn-primary" title="Archive snapshot" href="/snapshot/get?id={{ bookmark.id }}&url={{ request.get_full_path | urlencode }}" >Archive snapshot</a>                           
                  {% endif %}

                    {%if bookmark.isDocumentFile %}
                        <a target="_blank" href="{{ bookmark.modifiedURL }}" title="View document in Google Driver viewer" > <img src="{% static "gdriver.png" %}"> </a>
                    {% endif %}

                    <br/>                                

              <table class="item-table-info">
                  <tr>
                      <th class="row-label">Id</th>
                      <th>{{ bookmark.id }} </th>
                    </tr>
                  <tr>
                    <th class="row-label">Starred</th>
                    <th>{{ bookmark.starred }} </th>
                  </tr>
                  <tr>
                    <th class="row-label">Type</th>
                    <th> <a href="items?filter=doctype&A0={{ bookmark.doctype }}" 
                          title="Filter by document type"> {{ bookmark.doctype }} </a> 
                    </th>
                  </tr>

                  <tr>
                      <th class="row-label">Keywords</th>
                      <th>  {{ bookmark.keywords }} </th>                    
                  </tr>    
                  <tr>
                      <th class="row-label">Domain</th>
                      <th> <a href="items?filter=domain&A0={{ bookmark.hostname }}" title="Filter by domain {{ bookmark.hostname }}" > {{ bookmark.hostname }} </a> </th>                    
                  </tr>    
                  <tr>
                    <th class="row-label">Created</th>
                    <th>{{ bookmark.created }}</th>
                  </tr>

                  <tr>
                      <th class="row-label">Modified</th>
                      <th>{{ bookmark.updated }}</th>
                    </tr>
              </table>
              
            <ul>             
              {% if bookmark.snapshot_exists %}
                <li>  <a class="btn btn-primary" target="_blank" title="Open file snapshot file" 
                        href="/items/view/{{ bookmark.id}}"> View snapshot </a>                                            
                </li>
              {% endif %}
            </ul>          

            <p class = ""> {{ bookmark.brief|default:"" }} </p>

            {% if bookmark.is_youtube_video and request.session.video_toggle  %}
              <iframe src="https://www.youtube.com/embed/{{ bookmark.youtube_id }}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            {% endif %}
        </div>                            
    {% endfor %}
    

</div>

{% endblock %}
